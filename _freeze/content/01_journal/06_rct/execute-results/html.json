{
  "hash": "73f772c5b2aedc5bdb7b5c34a768f028",
  "result": {
    "markdown": "---\ntitle: \"Randomized Controlled Trials\"\n---\n\n\n# Assignment 6\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-1_4fc4ac4a80e0a1db47ab488e60305e1f'}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(ggplot2)\n```\n:::\n\n\n## Assignment 6.1\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-2_80d7a37a3ddfffc30ca0cb6f341d9fe9'}\n\n```{.r .cell-code}\n# Loading dataset into 'data'\ndata <- readRDS(\"data/abtest_online.rds\")\nstr(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> tibble [1,000 × 6] (S3: tbl_df/tbl/data.frame)\n#>  $ ip             : chr [1:1000] \"161.88.211.70\" \"239.86.201.0\" \"35.90.22.130\" \"219.176.193.3\" ...\n#>  $ chatbot        : logi [1:1000] TRUE TRUE TRUE FALSE TRUE TRUE ...\n#>  $ previous_visit : num [1:1000] 0 1 1 4 1 2 1 1 1 0 ...\n#>  $ mobile_device  : logi [1:1000] FALSE FALSE FALSE TRUE FALSE FALSE ...\n#>  $ purchase       : num [1:1000] 0 1 0 0 0 0 1 1 0 0 ...\n#>  $ purchase_amount: num [1:1000] 0 39.5 0 0 0 ...\n```\n:::\n\n```{.r .cell-code}\n# Convert non-numeric variables to numeric\ndata$mobile_device <- as.numeric(data$mobile_device)\ndata$chatbot <- as.numeric(data$chatbot)\n\n# Check covariate balance across groups using a plot \ncovariates <- c(\"mobile_device\", \"previous_visit\", \"purchase\", \"purchase_amount\") # Variables of interest\ngroup_var <- \"chatbot\"\n\n# Check covariate balance visually using plots\nplot_balances <- lapply(covariates, function(var) {\n  ggplot(data, aes_string(x = group_var, y = var, color = as.factor(group_var))) +\n    stat_summary(\n      geom = \"errorbar\", \n      width = 0.5,\n      fun.data = \"mean_se\", \n      fun.args = list(mult = 1.96),\n      show.legend = FALSE\n    ) +\n    labs(title = paste(\"Covariate Balance for\", var))\n})\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: `aes_string()` was deprecated in ggplot2 3.0.0.\n#> ℹ Please use tidy evaluation idioms with `aes()`.\n#> ℹ See also `vignette(\"ggplot2-in-packages\")` for more information.\n```\n:::\n\n```{.r .cell-code}\nplot_balances\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [[1]]\n```\n:::\n\n::: {.cell-output-display}\n![](06_rct_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> [[2]]\n```\n:::\n\n::: {.cell-output-display}\n![](06_rct_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> [[3]]\n```\n:::\n\n::: {.cell-output-display}\n![](06_rct_files/figure-html/unnamed-chunk-2-3.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> [[4]]\n```\n:::\n\n::: {.cell-output-display}\n![](06_rct_files/figure-html/unnamed-chunk-2-4.png){width=672}\n:::\n:::\n\nPlots shows in general, covariates are overall balanced when chatbot is True and False. However, when comparing previous_visits plots it can be seen that the CI(Confidence Intervals) overlap with each other.\n\n\n## Assignment 6.2: Running a regression on 'purchase_amount' to find the effect of chatbot on sales\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-3_a4d4bbb67d5f3c23cb18b34e0dd3828a'}\n\n```{.r .cell-code}\nsales_model <- lm(purchase_amount ~ chatbot, data = data)\nsummary(sales_model) # regression summary\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_amount ~ chatbot, data = data)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -16.702 -14.478  -9.626  13.922  64.648 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)  16.7017     0.8374  19.944  < 2e-16 ***\n#> chatbot      -7.0756     1.1796  -5.998 2.79e-09 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 18.65 on 998 degrees of freedom\n#> Multiple R-squared:  0.0348,\tAdjusted R-squared:  0.03383 \n#> F-statistic: 35.98 on 1 and 998 DF,  p-value: 2.787e-09\n```\n:::\n:::\n\nThe summary shows that the sales dropped for customers that used the chatbot with the chatbot coefficient value = -7.0756 \n\n## Assignment 6.3: Interaction between 'chatbot' and 'mobile_device' for subgroup effects\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-4_4b12db264c8cf95c11cde508910debc2'}\n\n```{.r .cell-code}\ninteraction_model <- lm(purchase_amount ~ chatbot * mobile_device, data = data)\nsummary(interaction_model) # regression summary (-0.1526 for chatbot:mobile_device)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_amount ~ chatbot * mobile_device, data = data)\n#> \n#> Residuals:\n#>    Min     1Q Median     3Q    Max \n#> -16.98 -14.54  -9.95  14.13  65.24 \n#> \n#> Coefficients:\n#>                       Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)            16.9797     1.0152  16.725   <2e-16 ***\n#> chatbot                -7.0301     1.4284  -4.922    1e-06 ***\n#> mobile_device          -0.8727     1.7987  -0.485    0.628    \n#> chatbot:mobile_device  -0.1526     2.5369  -0.060    0.952    \n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 18.66 on 996 degrees of freedom\n#> Multiple R-squared:  0.03534,\tAdjusted R-squared:  0.03244 \n#> F-statistic: 12.16 on 3 and 996 DF,  p-value: 8.034e-08\n```\n:::\n\n```{.r .cell-code}\n# Computing CATE for mobile users (subgroup)\nmobile_users <- data[data$mobile_device == 1, ]\n\n# Fit a model for mobile users\nmobile_users_model <- lm(purchase_amount ~ chatbot, data = mobile_users)\nsummary(mobile_users_model) # View regression summary\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_amount ~ chatbot, data = mobile_users)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -16.107 -16.107  -8.924  10.594  65.243 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)   16.107      1.498  10.751  < 2e-16 ***\n#> chatbot       -7.183      2.115  -3.395 0.000773 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 18.83 on 315 degrees of freedom\n#> Multiple R-squared:  0.03531,\tAdjusted R-squared:  0.03225 \n#> F-statistic: 11.53 on 1 and 315 DF,  p-value: 0.0007729\n```\n:::\n:::\n\n\n## Assignment 6.4: Run logistic regression for binary outcome 'purchase'\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-5_447dc5270817c9493094a21bdf7b9879'}\n\n```{.r .cell-code}\nlogistic_model <- glm(purchase ~ chatbot, \n                      family = binomial(link = 'logit'), data = data)\nsummary(logistic_model) # View regression summary\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> glm(formula = purchase ~ chatbot, family = binomial(link = \"logit\"), \n#>     data = data)\n#> \n#> Coefficients:\n#>             Estimate Std. Error z value Pr(>|z|)    \n#> (Intercept) -0.01613    0.08981  -0.180    0.857    \n#> chatbot     -0.98939    0.13484  -7.337 2.18e-13 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> (Dispersion parameter for binomial family taken to be 1)\n#> \n#>     Null deviance: 1329.1  on 999  degrees of freedom\n#> Residual deviance: 1273.3  on 998  degrees of freedom\n#> AIC: 1277.3\n#> \n#> Number of Fisher Scoring iterations: 4\n```\n:::\n\n```{.r .cell-code}\n# Now Interpreting the coefficient for 'chatbot'\n# Coefficients here represent log odds ratio. In order to get the odds ratio, coefficient for chatbot is exponentiated.\nexp(coef(logistic_model)[\"chatbot\"]) # Exponentiated coefficient for 'chatbot'\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>   chatbot \n#> 0.3718025\n```\n:::\n:::\n\nThe odds ratio amount to 0.371 which suggests that the customers are less likely to purchase something with the chatbot\n\n```\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}